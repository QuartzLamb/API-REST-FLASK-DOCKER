<!DOCTYPE html>
<html lang="en">

<head>
    <title>Listado de Issues</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>

    <div class="container mt-3">
        <h2>Listado de Issues:</h2>
        <div class="mb-3 mt-3">
            <label for="name">Nombre:</label>
            <input type="text" class="form-control" id="filter" placeholder="Ingresa el nombre del agente" name="filter">
            <button onclick="filterIssues()">Filtrar</button>
        </div>
        <ul id="issues">
            <script>
                const issues = {{ datos| tojson | safe }};
                let text = "";
                for (let i = 0; i < issues.length; i++) {
                    const listItem = document.createElement("li");
                    const date = new Date(issues[i].dateIssue * 1000);
                    const dateIssue = date.toLocaleString();
                    text += `<br>Fecha: ${dateIssue}<br> TÃ­tulo: ${issues[i].titleIssue} <br> Description: ${issues[i].descriptionIssue}<br> Agente: ${issues[i].agent}<br><br>`;
                    document.getElementById("issues").appendChild(listItem);
                }
                document.getElementById("issues").innerHTML = text;

                function filterIssues(){
                    const agent =  document.getElementById('filter').value;
                    $.ajax({
                        type: "POST",
                        url: "/issues",
                        data: {
                            filter: agent
                        }
                    })
                }

            </script>
        </ul>
    </div>
</body>

</html>